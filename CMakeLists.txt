# Copyright (c) 2018, Sergiy Yevtushenko
# Copyright (c) 2018-2020, Niklas Hauser
#
# This file is part of the modm project.
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

# This file was autogenerated by the modm cmake builder. Do not modify!

cmake_minimum_required(VERSION 3.6)

include(./modm/repo.cmake)

project(purpledrop)

file(GLOB APP_SOURCE_FILES 
    src/*.c
    src/*.cpp
    src/usb/*.c
    src/app.*.cpp)

list(APPEND SOURCE_FILES ${APP_SOURCE_FILES})

set(PERIPH lib/STM32F4xx_StdPeriph_Driver)
set(USB lib/STM32_USB_OTG_Driver)
set(USBD lib/STM32_USB_Device_Library)

include_directories(
    ${CMAKE_CURRENT_SOURCE_DIR}
    src/usb
    src/app
    ${PERIPH}/inc
    ${USB}/inc
    ${USBD}/Core/inc
    ${USBD}/Class/cdc/inc
)

add_executable(${CMAKE_PROJECT_NAME} ${SOURCE_FILES})
set_target_properties(${CMAKE_PROJECT_NAME} PROPERTIES SUFFIX ".elf")

add_custom_target(${CMAKE_PROJECT_NAME}.bin ALL DEPENDS ${CMAKE_PROJECT_NAME} COMMAND ${CMAKE_OBJCOPY} -Obinary ${CMAKE_PROJECT_NAME}.elf ${CMAKE_PROJECT_NAME}.bin)
add_custom_target(${CMAKE_PROJECT_NAME}.hex ALL DEPENDS ${CMAKE_PROJECT_NAME} COMMAND ${CMAKE_OBJCOPY} -Oihex ${CMAKE_PROJECT_NAME}.elf ${CMAKE_PROJECT_NAME}.hex)
add_custom_target(${CMAKE_PROJECT_NAME}.lss ALL DEPENDS ${CMAKE_PROJECT_NAME} COMMAND ${CMAKE_OBJDUMP}  -x -s -S -l -w ${CMAKE_PROJECT_NAME}.elf > ${CMAKE_PROJECT_NAME}.lss)
#% FIXME: build path does not contain python tools of course
#% add_custom_command(TARGET ${CMAKE_PROJECT_NAME} POST_BUILD COMMAND python3 ./modm/modm_tools/size.py ${CMAKE_PROJECT_NAME}.elf "[{'name': 'flash', 'access': 'rx', 'start': 134217728, 'size': 1572864}, {'name': 'ccm', 'access': 'rw', 'start': 268435456, 'size': 65536}, {'name': 'sram1', 'access': 'rwx', 'start': 536870912, 'size': 327680}, {'name': 'backup', 'access': 'rwx', 'start': 1073889280, 'size': 4096}]")
